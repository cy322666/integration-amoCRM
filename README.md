# Интеграция с amoCRM 

## Описание возможностей  
___
### Логирование

_Возможность логировать входящие запросы и запросы к amoCRM_

### Кеш

_Возможность кешировать информацию аккаунта amoCRM_

### Доп поля

_Возможность работать и передавать в amoCRM доп поля для сущностей_

### Распределение

_Возможность распределять заявки по менеджерам_

### Контроль дублей

_Возможность контролировать дубли сделок контакта_

### Игнорирование воронок

_Возможность игнорировать поиск активных сделок у контакта в определенных воронках_

### Добавление задачи

_Возможность создавать задачу для заявки_

### Добавление примечания

_Возможность создавать промечвние для заявки_

## Установка интеграции
____

Заходим по SSH на сервер в нужную папку клиента и выполняем команду

> **git clone https://github.com/cy322666/integration-amoCRM.git**

_Подтягивается основной код из удаленного репозитория_

_____

Затем заходим в ..integration-amoCRM/app/ и выполняем команду

> **composer install**

Если composer не прилинкован, то надо использовать полный путь к исполняемому файлу composer:

> **/opt/php/7.3/bin/php ~/bin/composer.phar install**

_Подтягиваются зависимости приложения_

_____

Для обновления библиотеки подключаемся по SSH к серверу, заходим в папку ..integration-amoCRM/ и выполняем команду

> **git pull**

_Подтягиваются обновленные файлы библиотеки, ваши изменения в файлах затронуты не будут_

## Авторизация клиента

----

_Задать указанным переменным значения, полученные при создании интеграции на стороне amoCRM и 
вызвать метод установки интеграции_
```$config->subdomain = '';
$config->client_id = '';

$config->client_secret = '';

$config->auth_code = '';

$config->redirect_url = '';

\app::install($config);
```
___

## Установка сценария

_Задаем нужные переменные для интеграции:_

```pipeline_id (integer)```  

_Воронка для создания сделки (если не задано, то главная воронка)_

```pipelines_ignore (array)```  

_Массив с воронками, в которых не нужно искать активную сделку (по умолчанию отключено)_ 
    
```status_id (integer)```  

_Статус для создания сделки (если не задано, то первый статус главной воронки)_

```responsible_id (integer)```  

_Ответственный для создания контакта и сделки (если не задано, то главный админ)_

```distribution (boolean)```  

_Распределять ли заявки по разным менеджерам_

```responsible_users (array)```  

_Массив с пользователями, на которые нужно распределять сделки (по очереди); (по умолчанию отключено)_

```control_double (boolean)```  

_Искать ли активные сделки у существующих контактов (по умолчанию включено)_

```create_task (boolean)```  

_Содавать ли задачу для заявки (по умолчанию включено)_

```task_text (string)```  

_Текст задачи (по умолчанию 'Клиент оставил повторную заявку на сайте')_

```completed_till_at (string)```  

_Время на выполнение задачи (по умолчанию 15 минут)_
- **15 minutes** - за 15 минут
- **2 hours** - в течение 2 часов
- **today** - до конца дня получения заявки
- **tomorrow** - До конца завтрашнего дня получения заявки
- и тп и тд

```create_note (boolean)```  

_Содавать ли примечание для заявки (по умолчанию включено)_

```user_name (string)```  

_Значение для имени контакта (по умолчанию 'Неизвестно')_

```user_phone (string)```  

_Телефон контакта_

```user_emai (string)```  

_Почта контакта_

```city (string)```

_Город контакта (поле Город у контакта)_

___

Для передачи данных в кастомные поля **сделки** используется следующая конструкция:

$config->lead_custom_fields = [
    'Точное название поля1' => 'Его значение',
    'Точное название поля2' => 'Его значение',
];

___

Для передачи данных в кастомные поля **контакта** используется следующая конструкция:

$config->contact_custom_fields = [
    'Точное название поля' => 'Его значение',
    'Точное название поля2' => 'Его значение',
];

___

Для создание дополнительного примечания используется следующая конструкция:

$config->note_text = [
	$test,
	'Какой-либо тест',
];

## Дополнительные настройки

___


## Структура интеграции

___


## Вспомогательная библиотека





